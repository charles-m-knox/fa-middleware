<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>{{.Title}}</title>
    <script src="https://js.stripe.com/v3/"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"></script>
    <script>
        // var stripe = Stripe('');
        $(document).ready(function () {
            $.get("/api/currentuser/email", function (data) {
                $("#user-email").html(data);
            });

            $("#set-data-btn").click(function () {
                $.ajax({
                    url: "/api/mutate",
                    type: "POST",
                    data: JSON.stringify({
                        "f": "saved_accounts",
                        "v": `${new Date().toUTCString()}`,
                        "m": "s"
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        alert(data);
                    }
                });
                // $.post("/api/mutate",
                //     {
                //         "f": "testfield",
                //         "v": `${new Date().toUTCString()}`,
                //         "m": "s"
                //     },
                //     function (data) {
                //         alert(data);
                //     },
                //     "application/json"
                // );
            });

            $("#get-data-btn").click(function () {
                $.ajax({
                    url: "/api/mutate",
                    type: "POST",
                    data: JSON.stringify({
                        "f": "saved_accounts",
                        "m": "g"
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    statusCode: {
                        200: (data) => {
                            data.then((data2) => {
                                console.log(data2);
                                $("#data-fill-span").html(data2);
                            });
                            console.log("success event fired");
                            console.log(data);
                            alert(data);
                        }
                    }
                });
                // $.post("/api/mutate",
                //     {
                //         "f": "testfield",
                //         "m": "g"
                //     },
                //     function (data, status) {
                //         console.log(data, status);
                //         $("#data-fill-span").text(data);
                //     },
                //     "json"
                // );
            });
            $("#get-subscriber-data-btn").click(function () {
                $.ajax({
                    url: "/api/mutate",
                    type: "POST",
                    data: JSON.stringify({
                        "f": "saved_results",
                        "m": "g"
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                });
            });
            $("#set-subscriber-data-btn").click(function () {
                $.ajax({
                    url: "/api/mutate",
                    type: "POST",
                    data: JSON.stringify({
                        "f": "saved_results",
                        "m": "s",
                        "v": `${new Date().toUTCString()}`,
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                });
            });
        });
    </script>
    <div class="container">
        <div class="row">
            <div class="col">
                <p>
                    Hello! Buy our product!
                </p>
                <p>
                    Using your JWT, your email address is: <span id="user-email">...</span>
                </p>
                <p>
                    The Stripe public key is {{.Conf.StripePublicKey}}.
                </p>
                <p>
                    <button id="set-data-btn" class="btn btn-primary mr-3">Set some data</button>
                    <button id="get-data-btn" class="btn btn-primary mr-3">Get the data that was just set</button>
                </p>
                <p>
                    <button id="set-subscriber-data-btn" class="btn btn-primary mr-3">Set some subscriber-only
                        data</button>
                    <button id="get-subscriber-data-btn" class="btn btn-primary mr-3">Get the subscriber-only data that
                        was just set</button>
                </p>
                <p>
                    <button id="set-system-data-btn" class="btn btn-primary mr-3">Set some system-only
                        data</button>
                    <button id="get-system-data-btn" class="btn btn-primary mr-3">Get the system-only data that was just
                        set</button>
                </p>
                <p>
                    <span id="data-fill-span">Press one of the buttons.</span>
                </p>
                <p>
                    <a href="/pages/t/stripecheckout.html">Back to checkout</a>.
                </p>
                <p>
                    <a href="/pages/t/">Back to make payment page.</a>
                </p>
            </div>
        </div>
    </div>
</body>

</html>